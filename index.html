<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C语言入门教程 (含AI助手)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            height: 100vh;
            margin: 0;
            overflow: hidden; 
        }
        #sidebar {
            width: 25%;
            min-width: 200px;
            max-width: 300px;
            background-color: #f3f4f6; 
            padding: 1.5rem; 
            overflow-y: auto;
            height: 100vh;
            border-right: 1px solid #e5e7eb; 
            z-index: 10; 
        }
        #content-area {
            width: 75%;
            padding: 2rem; 
            overflow-y: auto;
            height: 100vh;
            background-color: #ffffff; 
            position: relative; 
        }
        .nav-link {
            display: block;
            padding: 0.75rem 1rem; 
            margin-bottom: 0.5rem; 
            border-radius: 0.375rem; 
            color: #374151; 
            text-decoration: none;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        }
        .nav-link:hover {
            background-color: #e5e7eb; 
            color: #1f2937; 
        }
        .nav-link.active {
            background-color: #3b82f6; 
            color: white;
            font-weight: 500;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        h2 {
            font-size: 1.875rem; 
            font-weight: 600; 
            margin-bottom: 1.5rem; 
            color: #111827; 
            border-bottom: 2px solid #e5e7eb; 
            padding-bottom: 0.75rem; 
        }
        h3 {
            font-size: 1.5rem; 
            font-weight: 600; 
            margin-top: 2rem; 
            margin-bottom: 1rem; 
            color: #1f2937; 
        }
        p, li { 
            line-height: 1.75; 
            margin-bottom: 1rem; 
            color: #4b5563; 
        }
        li p {
            margin-bottom: 0.5rem; 
        }
        li:last-child p:last-child {
            margin-bottom: 0; 
        }
        .info-box {
            background-color: #e0f2fe; /* Tailwind sky-100 */
            border-left: 4px solid #0ea5e9; /* Tailwind sky-500 */
            padding: 1rem;
            margin: 1.5rem 0;
            border-radius: 0.25rem;
        }
        .info-box p {
            margin-bottom: 0.5rem;
            color: #0369a1; /* Tailwind sky-700 */
        }
        .info-box p:last-child {
            margin-bottom: 0;
        }
        .challenge-box {
            background-color: #fef3c7; /* Tailwind amber-100 */
            border-left: 4px solid #f59e0b; /* Tailwind amber-500 */
            padding: 1rem;
            margin: 1.5rem 0;
            border-radius: 0.25rem;
        }
        .challenge-box p {
            color: #b45309; /* Tailwind amber-700 */
        }

        pre {
            background-color: #1f2937; 
            color: #e5e7eb; 
            padding: 1rem; 
            border-radius: 0.375rem; 
            overflow-x: auto;
            margin-bottom: 1.5rem; 
            font-size: 0.9rem;
            line-height: 1.4; 
        }
        code { 
            font-family: 'Courier New', Courier, monospace;
            background-color: #e5e7eb; 
            color: #be123c; 
            padding: 0.125rem 0.25rem; 
            border-radius: 0.25rem; 
            font-size: 0.85em; 
        }
        pre code { 
            background-color: transparent;
            color: inherit;
            padding: 0;
            border-radius: 0;
            font-size: inherit; 
        }
        .code-comment { 
            color: #6ee7b7; /* Brighter green for comments in code */
        }

        #ai-chat-button {
            position: fixed;
            bottom: 2rem; 
            right: 2rem; 
            background-color: #3b82f6; 
            color: white;
            width: 3.5rem; 
            height: 3.5rem; 
            border-radius: 9999px; 
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); 
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            z-index: 1000; 
        }
        #ai-chat-button:hover {
            background-color: #2563eb; 
        }
        #ai-chat-modal {
            position: fixed;
            bottom: 6.5rem; 
            right: 2rem;
            width: 350px;
            max-width: 90vw;
            height: 500px;
            max-height: 70vh;
            background-color: white;
            border-radius: 0.5rem; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); 
            display: none; 
            flex-direction: column;
            z-index: 999; 
            border: 1px solid #e5e7eb; 
        }
        #ai-chat-modal.active {
            display: flex;
        }
        .chat-header {
            padding: 0.75rem 1rem; 
            background-color: #f9fafb; 
            border-bottom: 1px solid #e5e7eb; 
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top-left-radius: 0.5rem; 
            border-top-right-radius: 0.5rem; 
        }
        .chat-header h3 {
            margin: 0;
            font-size: 1.125rem; 
            font-weight: 500; 
            color: #1f2937; 
        }
        .chat-close-button {
            background: none;
            border: none;
            font-size: 1.5rem; 
            color: #6b7280; 
            cursor: pointer;
            padding: 0.25rem; 
        }
        .chat-close-button:hover {
            color: #1f2937; 
        }
        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem; 
            display: flex;
            flex-direction: column;
            gap: 0.75rem; 
        }
        .chat-message {
            padding: 0.5rem 0.75rem; 
            border-radius: 0.375rem; 
            max-width: 85%; 
            word-wrap: break-word;
            line-height: 1.6; 
        }
        .chat-message ul {
            list-style-type: disc;
            margin-left: 1.25rem; 
            padding-left: 0.5rem; 
        }
        .chat-message li {
            margin-bottom: 0.25rem; 
        }
        .user-message {
            background-color: #dbeafe; 
            color: #1e40af; 
            align-self: flex-end;
            margin-left: auto;
        }
        .ai-message {
            background-color: #f3f4f6; 
            color: #374151; 
            align-self: flex-start;
            margin-right: auto;
        }
        .ai-message pre { 
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
            white-space: pre-wrap; 
            word-break: break-all; 
        }
        .chat-input-area {
            border-top: 1px solid #e5e7eb; 
            padding: 0.75rem; 
            display: flex;
            gap: 0.5rem; 
        }
        .chat-input-area input {
            flex-grow: 1;
            padding: 0.5rem 0.75rem; 
            border: 1px solid #d1d5db; 
            border-radius: 0.375rem; 
            font-size: 0.875rem; 
        }
        .chat-input-area input:focus {
            outline: none;
            border-color: #3b82f6; 
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4); 
        }
        .chat-input-area button {
            background-color: #3b82f6; 
            color: white;
            padding: 0.5rem 1rem; 
            border: none;
            border-radius: 0.375rem; 
            cursor: pointer;
            font-size: 0.875rem; 
        }
        .chat-input-area button:hover {
            background-color: #2563eb; 
        }
        .chat-input-area button:disabled {
            background-color: #9ca3af; 
            cursor: not-allowed;
        }
        .loading-indicator {
            font-style: italic;
            color: #6b7280; 
            padding: 0.5rem 0.75rem;
        }
    </style>
</head>
<body>
    <aside id="sidebar">
        <h1 class="text-2xl font-bold text-blue-600 mb-8 text-center">C语言探险之旅</h1>
        <nav id="TableOfContents">
            <ul>
                </ul>
        </nav>
    </aside>

    <main id="content-area">
        <section id="welcome" class="content-section">
             <h2>🚀 欢迎来到C语言学习乐园！🎉</h2>
             <p>你好，未来的编程高手！准备好和我一起踏上激动人心的C语言探险之旅了吗？无论你是编程新手，还是想重温基础，这里都有你需要的。</p>
             <p>C语言就像是编程世界的“瑞士军刀”——小巧、强大，而且用途广泛！从操作系统到游戏引擎，从嵌入式设备到高性能计算，C语言无处不在。学会它，你就能更深入地理解计算机是如何工作的。</p>
             <div class="info-box">
                <p>💡 **小提示：** 在这个网站，你可以从左侧的目录选择你感兴趣的主题开始学习。每个主题都会有清晰的讲解和代码示例。遇到问题？别忘了右下角还有一位“Gemini AI编程助手”随时待命哦！</p>
             </div>
             <p>让我们一起揭开C语言的神秘面纱，感受编码的乐趣吧！选择一个章节，开始你的冒险！</p>
             <img src="https://placehold.co/600x350/3b82f6/ffffff?text=开启你的C语言冒险！&font=Inter" alt="一幅充满科技感和探索氛围的C语言学习之旅插画" class="my-6 rounded-lg shadow-xl mx-auto" onerror="this.onerror=null;this.src='https://placehold.co/600x300/e2e8f0/4a5568?text=Image+Not+Found';">
        </section>

        <section id="c-jianjie" class="content-section">
            <h2>C 简介：编程世界的常青树 🌳</h2>
            <p>想象一下，你要和计算机“说话”，让它帮你完成各种任务。C语言就是一种你和计算机沟通的“语言”。它诞生于上世纪70年代，比很多我们现在常用的App都要年长，但它依然是编程界一颗闪亮的星！</p>
            <p>为什么C语言如此重要？因为它：</p>
            <ul class="list-disc list-inside mb-4 pl-4 text-gray-600">
                <li><strong>高效快捷：</strong> C语言运行起来非常快，像个短跑冠军。很多对性能要求极高的软件，比如操作系统（Windows, Linux, macOS的核心部分都有C的影子）、数据库，甚至一些游戏引擎，都喜欢用C语言来编写。</li>
                <li><strong>接近硬件：</strong> 学习C语言能让你更了解计算机的“内心世界”，比如内存是如何管理的。它就像一座桥梁，连接着高级的软件应用和底层的硬件。</li>
                <li><strong>功能强大且灵活：</strong> 你可以用它做很多很酷的事情，从写一个小工具到构建一个复杂的系统。</li>
                <li><strong>是很多现代语言的基石：</strong> 像C++、Java、Python、C#这些流行的编程语言，或多或少都受到了C语言的影响。学会了C，再学它们会感觉轻松不少！</li>
            </ul>
            <div class="info-box">
                <p>🧐 **你知道吗？** UNIX操作系统，这个现代操作系统的鼻祖之一，大部分就是用C语言写成的。这足以证明C语言的强大和可靠！</p>
            </div>
            <h3>第一个C程序：向世界问好！👋 ("Hello, World!")</h3>
            <p>学习任何一门编程语言，我们通常都会从编写一个“Hello, World!”程序开始。这就像是和这门语言打个招呼。下面，我们就来看看C语言版的“Hello, World!”长什么样：</p>
            <pre><code class="language-c"><span class="code-comment">// 嗨，这是一行注释，计算机会忽略它，这是写给我们自己看的。</span>
<span class="code-comment">// 告诉编译器，我们要用一些标准“工具”，比如打印文字到屏幕上。</span>
#include &lt;stdio.h&gt;

<span class="code-comment">// C程序的“大门”从这里开始，程序会从 main 函数的第一行开始执行。</span>
<span class="code-comment">// int 表示这个大门完成任务后会给操作系统一个整数“回执”。</span>
int main() {
   <span class="code-comment">// 这就是魔法发生的地方！printf 是一个“打印”函数，</span>
   <span class="code-comment">// 它会把括号里双引号之间的文字显示到你的屏幕上。</span>
   <span class="code-comment">// \n 是一个特殊符号，意思是“换一行”。</span>
   printf("Hello, World!\n");
   
   <span class="code-comment">// 任务圆满完成！给操作系统一个“0”作为回执，表示一切顺利。</span>
   return 0;
}</code></pre>
            <p>是不是很简单？把这段代码复制到你的C语言编译环境中运行一下，你就能在屏幕上看到 "Hello, World!" 这句友好的问候啦！</p>
            <div class="challenge-box">
                <p>🏅 **动手试试：**</p>
                <ul class="list-disc list-inside ml-4">
                    <li>尝试修改双引号里的文字，比如改成 "你好，C语言！" 或者你的名字，然后重新运行程序看看会发生什么？</li>
                    <li>如果去掉 `\n` 会怎么样？亲自试一试，观察输出有什么不同。</li>
                </ul>
            </div>
        </section>

        <section id="c-huanjingshezhi" class="content-section">
            <h2>C 环境设置：搭建你的编程工作室 🛠️</h2>
            <p>要在你的计算机上施展C语言魔法，首先需要搭建一个“编程工作室”。这主要包括一个C编译器和文本编辑器（或者一个集成开发环境IDE）。</p>
            <p>编译器就像一个翻译官，它能把你用C语言写的代码（源文件，通常以 `.c` 结尾）翻译成计算机能直接执行的机器指令（可执行文件）。</p>
            <h3>主流编译器</h3>
            <ul class="list-disc list-inside mb-4 pl-4">
                <li><strong>GCC (GNU Compiler Collection):</strong> 这是Linux和macOS上最常用的编译器，免费且开源。Windows上可以通过MinGW或Cygwin来使用它。</li>
                <li><strong>Clang:</strong> 一个由Apple主导开发的编译器，性能优异，与GCC高度兼容，也是macOS上的默认C编译器。</li>
                <li><strong>MSVC (Microsoft Visual C++):</strong> Windows平台上Visual Studio IDE内置的编译器。</li>
            </ul>
            <h3>Windows 环境搭建指南</h3>
            <p>在 Windows 上，推荐初学者使用以下任一方案：</p>
            <ol class="list-decimal list-inside mb-4 pl-4 text-gray-600">
                <li>
                    <strong>MinGW-w64 (推荐给喜欢轻量级工具的同学):</strong>
                    <p>MinGW (Minimalist GNU for Windows) 提供了一个Windows上的GCC工具集。你可以从 <a href="https://www.mingw-w64.org/downloads/" target="_blank" class="text-blue-500 hover:underline">MinGW-w64官网</a>下载。安装后，记得将编译器的 `bin` 目录 (例如 `C:\mingw-w64\x86_64-8.1.0-posix-seh-rt_v6-rev0\mingw64\bin`) 添加到系统的 `PATH` 环境变量中，这样你才能在任何路径下使用 `gcc` 命令。</p>
                </li>
                <li>
                    <strong>Visual Studio Community (功能强大的一站式选择):</strong>
                    <p>从 <a href="https://visualstudio.microsoft.com/vs/community/" target="_blank" class="text-blue-500 hover:underline">Visual Studio官网</a> 下载并安装社区版（免费）。在安装时，请确保勾选“使用C++的桌面开发”这个工作负载，它会自动包含C/C++编译器和相关工具。</p>
                    <img src="https://placehold.co/600x350/e2e8f0/4a5568?text=Visual+Studio安装C++工作负载截图" alt="Visual Studio安装程序中选择“使用C++的桌面开发”工作负载的界面截图" class="my-4 rounded-md shadow-md" onerror="this.onerror=null;this.src='https://placehold.co/600x300/e2e8f0/4a5568?text=Image+Not+Found';">
                </li>
            </ol>
            <h3>macOS 环境搭建指南</h3>
            <p>macOS用户非常幸运，通常系统已经内置了强大的开发工具。你只需要打开“终端” (Terminal) 应用，然后输入以下命令来安装Xcode命令行工具 (Command Line Tools)，它包含了Clang编译器：</p>
            <pre><code>xcode-select --install</code></pre>
            <p>按照提示完成安装即可。</p>
            <h3>Linux 环境搭建指南</h3>
            <p>大多数Linux发行版（如Ubuntu, Fedora, CentOS等）可能已经预装了GCC。如果没有，或者你想安装最新版本，可以使用你的发行版的包管理器。例如：</p>
            <p>在基于 Debian/Ubuntu 的系统上 (如 Ubuntu, Linux Mint):</p>
            <pre><code>sudo apt update
sudo apt install gcc build-essential</code></pre>
            <p>在基于 Fedora 的系统上:</p>
            <pre><code>sudo dnf install gcc</code></pre>
            <h3>验证安装是否成功</h3>
            <p>无论你使用哪个操作系统，安装完成后，都可以打开终端（Windows上是命令提示符或PowerShell），输入以下命令来检查编译器是否安装成功：</p>
            <pre><code>gcc --version</code></pre>
            <p>或者，如果你安装的是Clang (macOS)：</p>
            <pre><code>clang --version</code></pre>
            <p>如果屏幕上显示了编译器的版本信息，那么恭喜你，你的C语言编程工作室已经初步搭建完成啦！</p>
        </section>
        
        <section id="c-vscode" class="content-section">
            <h2>C VSCode</h2>
            <p>Visual Studio Code (VSCode) 是一款轻量级但功能强大的源代码编辑器，它支持包括 C 在内的多种编程语言。通过安装适当的扩展，VSCode 可以为 C 语言开发提供优秀的支持，包括代码高亮、智能感知、调试等功能。</p>
            <h3>安装 VSCode</h3>
            <p>访问 <a href="https://code.visualstudio.com/" target="_blank" class="text-blue-500 hover:underline">VSCode官网</a> 下载并安装适合你操作系统的版本。</p>
            <h3>安装 C/C++ 扩展</h3>
            <p>打开 VSCode，点击侧边栏的扩展图标 (Extensions view icon，通常是四个方块的图标)，在搜索框中输入 "C/C++"，然后找到由 Microsoft 提供的官方扩展 (通常名为 "C/C++") 并点击安装。这个扩展是C语言开发的核心，能提供语法高亮、代码补全（IntelliSense）、调试支持等强大功能。</p>
    
            <h3>配置编译和调试</h3>
            <p>要在 VSCode 中顺利编译和调试你的 C 程序，你需要告诉 VSCode 如何找到你的编译器以及如何运行你的程序。这通常通过配置两个 JSON 文件来完成：`tasks.json`（定义编译任务）和 `launch.json`（定义调试会话）。</p>
            <ol class="list-decimal list-inside mb-4 pl-4 text-gray-600">
                <li>在 VSCode 中打开你存放 C 代码的文件夹 (File > Open Folder...)。</li>
                <li>创建一个简单的 C 源文件，例如 `hello.c`，并写入你的 "Hello, World!" 程序。</li>
                <li>
                    <strong>配置编译任务 (`tasks.json`):</strong>
                    <ul>
                        <li>按下 `Ctrl+Shift+P` (Windows/Linux) 或 `Cmd+Shift+P` (macOS) 打开命令面板。</li>
                        <li>输入 "Tasks: Configure Default Build Task" 并回车。</li>
                        <li>选择你的编译器，例如 "C/C++: gcc.exe build active file" (如果你用的是GCC) 或类似 Clang 的选项。VSCode 会自动在你的项目文件夹下创建一个 `.vscode` 目录，并在其中生成一个 `tasks.json` 文件。这个文件定义了如何使用编译器编译当前打开的文件。</li>
                    </ul>
                </li>
                <li>
                    <strong>配置调试环境 (`launch.json`):</strong>
                    <ul>
                        <li>切换到 VSCode 侧边栏的 "运行和调试" 视图 (Run and Debug view icon, 通常是一个带有播放按钮和虫子图标的)。</li>
                        <li>如果看到 "create a launch.json file" 的链接，点击它。如果看不到，可以点击顶部齿轮图标选择 "添加配置..."。</li>
                        <li>选择环境，例如 "C++ (GDB/LLDB)" (适用于GCC/Clang) 或 "C++ (Windows)" (适用于MSVC)。</li>
                        <li>VSCode 会在 `.vscode` 目录下生成一个 `launch.json` 文件。你需要确保 `program` 字段正确指向你编译后生成的可执行文件的路径。通常可以设置为：
                            <ul class="list-disc list-inside ml-4">
                                <li>Windows (GCC/Clang): <code>"${fileDirname}\\${fileBasenameNoExtension}.exe"</code></li>
                                <li>Linux/macOS (GCC/Clang): <code>"${fileDirname}/${fileBasenameNoExtension}"</code></li>
                            </ul>
                           这个路径告诉调试器启动哪个程序。同时，`preLaunchTask` 字段应与 `tasks.json` 中定义的编译任务名称匹配，以确保在调试前自动编译代码。
                        </li>
                    </ul>
                </li>
            </ol>
            <p>配置完成后，你就可以使用快捷键 (通常是 `Ctrl+Shift+B` 或 `Cmd+Shift+B` 来编译，`F5` 来启动调试) 愉快地在VSCode中编写和调试C程序了！</p>
            <div class="info-box">
                <p>💡 **小技巧：** VSCode 的 C/C++ 扩展非常强大，多探索它的设置和功能，比如代码片段、代码格式化、错误提示等，能极大提升你的编程效率。</p>
            </div>
        </section>
        <section id="c-ai-bianchengzhushou" class="content-section">
            <h2>C AI 编程助手 (内置)</h2>
            <p>除了可以使用 VSCode 扩展形式的 AI 编程助手外，本网站右下角也集成了一个 Gemini AI 助手，你可以点击它进行 C 语言相关的提问。</p>
            <p>AI 编程助手，如 GitHub Copilot、Tabnine 或本站集成的 Gemini，可以显著提高 C 语言的开发效率。它们通过分析你的代码上下文来提供智能的代码建议、自动补全，甚至生成整个函数或代码块。</p>
            <h3>主要功能</h3>
            <ul class="list-disc list-inside mb-4 pl-4 text-gray-600">
                <li><strong>代码自动补全：</strong> 根据已输入的代码，预测并建议接下来的代码片段。</li>
                <li><strong>代码生成：</strong> 根据注释或函数签名生成完整的代码实现。</li>
                <li><strong>问题解答：</strong> 解答关于C语言语法、库函数、编程概念等方面的问题。</li>
                <li><strong>错误检测与修复建议：</strong> 一些 AI 助手可以帮助识别潜在的错误并提供修复方案。</li>
                <li><strong>学习与文档辅助：</strong> 快速查找相关函数用法或代码示例。</li>
            </ul>
        
            <h3>注意事项</h3>
            <ul class="list-disc list-inside mb-4 pl-4 text-gray-600">
                <li><strong>理解而非盲从：</strong> AI 生成的代码或解释可能并不总是完美或最优的。务必理解其工作原理，并进行必要的测试和修改。</li>
                <li><strong>隐私与安全：</strong> 注意你所使用的代码和数据可能会被发送到云端进行分析。</li>
                <li><strong>学习工具：</strong> AI 助手可以作为学习 C 语言的辅助工具，帮助你探索不同的实现方式，但不应取代扎实的基础知识学习。</li>
            </ul>
        </section>

        <section id="c-chengxujiegou" class="content-section">
            <h2>C 程序结构</h2>
            <p>一个典型的 C 程序主要由以下几个部分组成：</p>
            <ul class="list-disc list-inside mb-4 pl-4 text-gray-600">
                <li><strong>预处理器指令 (Preprocessor Directives):</strong> 例如 `#include` 用于引入头文件，`#define` 用于定义宏。它们在编译之前由预处理器处理。</li>
                <li><strong>全局声明 (Global Declarations):</strong> 在所有函数外部声明的变量或函数，它们在整个程序中都可见。</li>
                <li><strong>主函数 `main()`:</strong> 每个 C 程序都必须有一个 `main` 函数，它是程序执行的入口点。</li>
                <li><strong>用户自定义函数 (User-defined Functions):</strong> 除了 `main` 函数外，程序可以包含其他由程序员定义的函数，用于执行特定任务。</li>
                <li><strong>注释 (Comments):</strong> 用于解释代码，提高可读性。C 语言支持单行注释 `// ...` 和多行注释 `/* ... */`。</li>
            </ul>
            <h3>示例程序结构</h3>
            <pre><code class="language-c"><span class="code-comment">// 1. 预处理器指令</span>
#include &lt;stdio.h&gt; <span class="code-comment">// 引入标准输入输出头文件</span>

#define PI 3.14159 <span class="code-comment">// 定义一个名为 PI 的宏</span>

<span class="code-comment">// 2. 全局声明 (可选)</span>
int global_variable = 100; <span class="code-comment">// 这是一个全局变量</span>

<span class="code-comment">// 函数原型声明 (如果函数定义在调用之后)</span>
void print_message(void);

<span class="code-comment">// 3. 主函数 main() - 程序入口</span>
int main() {
    printf("Hello from main function!\n");
    printf("Value of PI: %f\n", PI);
    printf("Global variable: %d\n", global_variable);

    print_message(); <span class="code-comment">// 调用用户自定义函数</span>
    
    return 0; <span class="code-comment">// 表示程序成功结束</span>
}

<span class="code-comment">// 4. 用户自定义函数</span>
void print_message(void) {
    printf("Hello from print_message function!\n");
}

<span class="code-comment">/*
5. 这是
   一个多行
   注释示例。
*/</span></code></pre>
            <p>理解 C 程序的结构是编写清晰、可维护代码的基础。</p>
        </section>

        <section id="c-jichuyufa" class="content-section">
            <h2>C 基础语法</h2>
            <p>C 语言的语法相对简洁，但有一些核心概念需要掌握：</p>
            <ul class="list-disc list-inside mb-4 pl-4 text-gray-600">
                <li><strong>标识符 (Identifiers):</strong> 用于命名变量、函数、数组等的名称。它们由字母、数字和下划线组成，且不能以数字开头。C 语言是大小写敏感的。</li>
                <li><strong>关键字 (Keywords):</strong> C 语言保留了一些具有特殊含义的词，如 `int`, `float`, `if`, `else`, `for`, `while` 等，它们不能用作标识符。</li>
                <li><strong>分号 (Semicolons):</strong> C 语言中，每个语句都必须以分号结束。</li>
                <li><strong>代码块 (Blocks):</strong> 用花括号 `{}`括起来的一组语句，通常用于函数体、循环体、条件语句等。</li>
                <li><strong>注释 (Comments):</strong> `//` 用于单行注释, `/* ... */` 用于多行注释。</li>
            </ul>
            <h3>示例</h3>
            <pre><code class="language-c">#include &lt;stdio.h&gt;

int main() { <span class="code-comment">// main 是一个关键字，也是程序的入口函数</span>
    <span class="code-comment">// 变量声明与初始化</span>
    int age = 30;         <span class="code-comment">// age 是一个标识符，int 是关键字，语句以分号结束</span>
    float salary = 5000.50; <span class="code-comment">// salary 是标识符，float 是关键字</span>
    char initial = 'J';   <span class="code-comment">// initial 是标识符，char 是关键字</span>

    <span class="code-comment">// 输出语句</span>
    printf("Age: %d\n", age);
    printf("Salary: %.2f\n", salary);
    printf("Initial: %c\n", initial);

    <span class="code-comment">// 这是一个代码块，用于 if 条件语句</span>
    if (age > 18) {
        printf("成年人。\n");
    } else {
        printf("未成年人。\n");
    }

    return 0; <span class="code-comment">// return 是关键字</span>
} <span class="code-comment">// 函数体结束</span></code></pre>
            <p>掌握这些基础语法是编写任何 C 程序的前提。</p>
        </section>

        <section id="c-shujuleixing" class="content-section">
            <h2>C 数据类型</h2>
            <p>数据类型用于指定变量可以存储的数据的种类和大小。C 语言提供了多种内置的数据类型：</p>
            <ul class="list-disc list-inside mb-4 pl-4 text-gray-600">
                <li><strong>基本数据类型:</strong>
                    <ul class="list-disc list-inside ml-6">
                        <li>`int`: 整数类型，通常占用 4 个字节。</li>
                        <li>`char`: 字符类型，通常占用 1 个字节，用于存储单个字符。</li>
                        <li>`float`: 单精度浮点数，通常占用 4 个字节。</li>
                        <li>`double`: 双精度浮点数，通常占用 8 个字节，精度比 `float` 高。</li>
                        <li>`void`: 表示无类型，常用于函数返回类型或指针类型。</li>
                    </ul>
                </li>
                <li><strong>修饰符 (Modifiers):</strong> 可以与基本数据类型结合使用，改变其含义或大小。
                    <ul class="list-disc list-inside ml-6">
                        <li>`short`: 通常使 `int` 类型占用更少的内存 (如 2 字节)。</li>
                        <li>`long`: 通常使 `int` 或 `double` 类型占用更多的内存或表示更大范围的数。</li>
                        <li>`signed`: 表示有符号数 (可以为正、负或零)，是默认的。</li>
                        <li>`unsigned`: 表示无符号数 (只能为正或零)，可以表示更大的正数范围。</li>
                    </ul>
                </li>
            </ul>
            <h3>示例</h3>
            <pre><code class="language-c">#include &lt;stdio.h&gt;
#include &lt;limits.h&gt; <span class="code-comment">// 用于获取数据类型的范围</span>
#include &lt;float.h&gt;  <span class="code-comment">// 用于获取浮点类型的范围</span>

int main() {
    int age = 25;
    char grade = 'A';
    float score = 95.5f; <span class="code-comment">// f 后缀表示 float 类型</span>
    double precise_value = 12345.6789;

    short small_number = 100;
    long large_number = 1234567890L; <span class="code-comment">// L 后缀表示 long 类型</span>
    unsigned int positive_count = 50000;

    printf("Age (int): %d, Size: %zu bytes\n", age, sizeof(age));
    printf("Grade (char): %c, Size: %zu bytes\n", grade, sizeof(grade));
    printf("Score (float): %.1f, Size: %zu bytes\n", score, sizeof(score));
    printf("Precise Value (double): %lf, Size: %zu bytes\n", precise_value, sizeof(precise_value));
    
    printf("Small Number (short): %hd, Size: %zu bytes\n", small_number, sizeof(small_number));
    printf("Large Number (long): %ld, Size: %zu bytes\n", large_number, sizeof(large_number));
    printf("Positive Count (unsigned int): %u, Size: %zu bytes\n", positive_count, sizeof(positive_count));

    printf("\nRanges:\n");
    printf("INT_MIN: %d, INT_MAX: %d\n", INT_MIN, INT_MAX);
    printf("UINT_MAX: %u\n", UINT_MAX);
    printf("FLT_MIN: %e, FLT_MAX: %e\n", FLT_MIN, FLT_MAX);
    printf("DBL_MIN: %e, DBL_MAX: %e\n", DBL_MIN, DBL_MAX);

    return 0;
}</code></pre>
            <p>`sizeof()` 运算符用于获取数据类型或变量所占用的内存大小（以字节为单位）。</p>
        </section>

        <section id="c-bianliang" class="content-section">
            <h2>C 变量</h2>
            <p>变量是程序中用于存储数据值的命名内存位置。在使用变量之前，必须先声明它，即指定变量的类型和名称。</p>
            <h3>变量声明</h3>
            <p>语法: `data_type variable_name;`</p>
            <p>例如: `int age;` `float salary;` `char initial;`</p>
            <h3>变量初始化</h3>
            <p>可以在声明变量的同时为其赋初始值，这称为初始化。</p>
            <p>语法: `data_type variable_name = value;`</p>
            <p>例如: `int age = 30;` `float salary = 60000.0;` `char grade = 'A';`</p>
            <h3>变量命名规则</h3>
            <ul class="list-disc list-inside mb-4 pl-4 text-gray-600">
                <li>变量名可以包含字母、数字和下划线 `_`。</li>
                <li>变量名必须以字母或下划线开头，不能以数字开头。</li>
                <li>变量名区分大小写 (例如, `age` 和 `Age` 是两个不同的变量)。</li>
                <li>不能使用 C 语言的关键字作为变量名 (例如, `int`, `if`, `while` 等)。</li>
            </ul>
            <h3>示例</h3>
            <pre><code class="language-c">#include &lt;stdio.h&gt;

int main() {
    <span class="code-comment">// 声明变量</span>
    int count;
    double price;
    char letter;

    <span class="code-comment">// 初始化变量</span>
    count = 10;
    price = 25.99;
    letter = 'X';

    printf("Count: %d\n", count);
    printf("Price: %.2f\n", price);
    printf("Letter: %c\n", letter);

    <span class="code-comment">// 声明并同时初始化</span>
    int score = 100;
    float pi_approx = 3.14f;

    printf("Score: %d\n", score);
    printf("Pi Approximation: %.2f\n", pi_approx);

    <span class="code-comment">// 修改变量的值</span>
    score = 95;
    printf("Updated Score: %d\n", score);

    return 0;
}</code></pre>
        </section>

        <section id="c-changliang" class="content-section">
            <h2>C 常量</h2>
            <p>常量是程序中其值在执行期间不能被修改的固定值。常量可以是任何基本数据类型。</p>
            <h3>定义常量的方法</h3>
            <ol class="list-decimal list-inside mb-4 pl-4 text-gray-600">
                <li><strong>使用 `#define` 预处理器指令:</strong>
                    <p>语法: `#define CONSTANT_NAME value`</p>
                    <p>这是一种文本替换，预处理器会在编译前将所有 `CONSTANT_NAME` 替换为 `value`。</p>
                </li>
                <li><strong>使用 `const` 关键字:</strong>
                    <p>语法: `const data_type variable_name = value;`</p>
                    <p>这会创建一个只读变量，编译器会检查确保其值不被修改。</p>
                </li>
            </ol>
            <h3>示例</h3>
            <pre><code class="language-c">#include &lt;stdio.h&gt;

<span class="code-comment">// 1. 使用 #define 定义常量</span>
#define PI 3.14159
#define GREETING "Hello, C World!"
#define MAX_USERS 100

int main() {
    printf("Value of PI defined by #define: %f\n", PI);
    printf("Greeting: %s\n", GREETING);
    printf("Max Users: %d\n", MAX_USERS);

    <span class="code-comment">// 尝试修改 #define 定义的常量 (会导致编译错误或意外行为，因为是文本替换)</span>
    <span class="code-comment">// PI = 3.14; // 错误!</span>

    <span class="code-comment">// 2. 使用 const 关键字定义常量</span>
    const int DAYS_IN_WEEK = 7;
    const float GRAVITY = 9.8f;
    const char YES_OPTION = 'Y';

    printf("\nDays in a week (const int): %d\n", DAYS_IN_WEEK);
    printf("Gravity (const float): %.1f\n", GRAVITY);
    printf("Yes Option (const char): %c\n", YES_OPTION);

    <span class="code-comment">// 尝试修改 const 定义的常量 (会导致编译错误)</span>
    <span class="code-comment">// DAYS_IN_WEEK = 8; // 错误: assignment of read-only variable 'DAYS_IN_WEEK'</span>

    return 0;
}</code></pre>
            <h3>`#define` vs `const`</h3>
            <ul class="list-disc list-inside mb-4 pl-4 text-gray-600">
                <li>`#define` 是预处理器指令，进行简单的文本替换，没有类型检查。</li>
                <li>`const` 是类型安全的，常量有明确的数据类型，编译器可以进行类型检查。</li>
                <li>`const` 常量有作用域（例如在函数内部定义），而 `#define` 通常是全局的（从定义点到文件末尾）。</li>
                <li>在现代 C 编程中，通常更推荐使用 `const` 来定义常量，因为它更安全且易于调试。</li>
            </ul>
        </section>

        <section id="c-cunchulei" class="content-section">
            <h2>C 存储类</h2>
            <p>存储类定义了 C 程序中变量/函数的作用域 (visibility) 和生命周期 (life-time)。</p>
            <p>C 语言中有以下几种存储类：</p>
            <ul class="list-disc list-inside mb-4 pl-4 text-gray-600">
                <li><strong>`auto` (自动存储类):</strong>
                    <ul class="list-disc list-inside ml-6">
                        <li>默认的存储类，用于在函数内部声明的局部变量。</li>
                        <li>作用域：仅在声明它们的函数或代码块内部可见。</li>
                        <li>生命周期：当进入函数/代码块时创建，退出时销毁。</li>
                        <li>可以省略 `auto` 关键字，例如 `int x;` 等同于 `auto int x;`。</li>
                    </ul>
                </li>
                <li><strong>`register` (寄存器存储类):</strong>
                    <ul class="list-disc list-inside ml-6">
                        <li>建议编译器将变量存储在 CPU 寄存器中以加快访问速度。</li>
                        <li>作用域和生命周期与 `auto` 类似。</li>
                        <li>这只是一个建议，编译器可能会忽略它。不能获取 `register` 变量的地址。</li>
                        <li>现代编译器优化通常做得很好，`register` 的使用已不常见。</li>
                    </ul>
                </li>
                <li><strong>`static` (静态存储类):</strong>
                    <ul class="list-disc list-inside ml-6">
                        <li>当用于局部变量时：变量的生命周期延长到整个程序执行期间，但作用域仍限于声明它的函数/代码块。变量只初始化一次。</li>
                        <li>当用于全局变量或函数时：限制其链接属性为内部链接，即该变量或函数只能在定义它的源文件中访问。</li>
                    </ul>
                </li>
                <li><strong>`extern` (外部存储类):</strong>
                    <ul class="list-disc list-inside ml-6">
                        <li>用于声明一个在其他文件中定义的全局变量或函数。它告诉编译器该变量/函数是在别处定义的。</li>
                        <li>不分配存储空间，只是引用已存在的存储位置。</li>
                    </ul>
                </li>
            </ul>
            <h3>示例</h3>
            <pre><code class="language-c">#include &lt;stdio.h&gt;

<span class="code-comment">// extern int external_var; // 假设 external_var 在另一个文件中定义</span>
<span class="code-comment">// extern void external_function();</span>

static int file_scope_static_var = 10; <span class="code-comment">// 只能在此文件内访问</span>

void counter_function() {
    auto int auto_var = 0; <span class="code-comment">// 每次调用函数时重新创建和初始化 (如果未显式初始化则为垃圾值)</span>
    static int static_var = 0; <span class="code-comment">// 只初始化一次，值在函数调用间保持</span>
    register int register_var = 0; <span class="code-comment">// 建议存储在寄存器中</span>

    auto_var++;
    static_var++;
    register_var++;

    printf("auto_var = %d, static_var = %d, register_var = %d\n", auto_var, static_var, register_var);
}

int main() {
    printf("Calling counter_function first time:\n");
    counter_function();

    printf("\nCalling counter_function second time:\n");
    counter_function();

    printf("\nCalling counter_function third time:\n");
    counter_function();

    printf("\nFile scope static variable: %d\n", file_scope_static_var);
    
    <span class="code-comment">// printf("Accessing external_var: %d\n", external_var); // 如果 external_var 已链接</span>
    <span class="code-comment">// external_function(); // 如果 external_function 已链接</span>

    return 0;
}</code></pre>
        </section>

        <section id="c-yunsuanfu" class="content-section">
            <h2>C 运算符</h2>
            <p>运算符是用于执行操作的符号，例如算术运算、逻辑运算等。C 语言提供了丰富的运算符：</p>
            <ul class="list-disc list-inside mb-4 pl-4 text-gray-600">
                <li><strong>算术运算符:</strong> `+` (加), `-` (减), `*` (乘), `/` (除), `%` (取模/求余)。</li>
                <li><strong>关系运算符:</strong> `==` (等于), `!=` (不等于), `>` (大于), `<` (小于), `>=` (大于等于), `<=` (小于等于)。返回值为 1 (真) 或 0 (假)。</li>
                <li><strong>逻辑运算符:</strong> `&&` (逻辑与), `||` (逻辑或), `!` (逻辑非)。</li>
                <li><strong>位运算符:</strong> `&` (按位与), `|` (按位或), `^` (按位异或), `~` (按位取反), `<<` (左移), `>>` (右移)。</li>
                <li><strong>赋值运算符:</strong> `=` (赋值), `+=`, `-=`, `*=`, `/=`, `%=`, `&=`, `|=`, `^=`, `<<=`, `>>=` (复合赋值)。</li>
                <li><strong>杂项运算符:</strong>
                    <ul class="list-disc list-inside ml-6">
                        <li>`sizeof()`: 返回变量或类型的大小 (以字节为单位)。</li>
                        <li>`&`: 返回变量的地址 (指针)。</li>
                        <li>`*`: 指向一个变量 (指针解引用)。</li>
                        <li>`? :` (条件运算符/三元运算符): `condition ? value_if_true : value_if_false`。</li>
                        <li>`,` (逗号运算符): 顺序执行多个表达式，并返回最后一个表达式的值。</li>
                    </ul>
                </li>
                <li><strong>自增/自减运算符:</strong> `++` (自增), `--` (自减)。有前缀 (`++a`) 和后缀 (`a++`) 两种形式。</li>
            </ul>
            <h3>示例</h3>
            <pre><code class="language-c">#include &lt;stdio.h&gt;

int main() {
    int a = 10, b = 4;
    int result;

    <span class="code-comment">// 算术运算符</span>
    printf("--- 算术运算符 ---\n");
    printf("a + b = %d\n", a + b);
    printf("a - b = %d\n", a - b);
    printf("a * b = %d\n", a * b);
    printf("a / b = %d (整数除法)\n", a / b);
    printf("a %% b = %d (取模)\n", a % b);

    <span class="code-comment">// 关系运算符</span>
    printf("\n--- 关系运算符 ---\n");
    printf("a == b is %d\n", a == b); <span class="code-comment">// 0 for false, 1 for true</span>
    printf("a != b is %d\n", a != b);
    printf("a > b is %d\n", a > b);

    <span class="code-comment">// 逻辑运算符</span>
    printf("\n--- 逻辑运算符 ---\n");
    int x = 1, y = 0; <span class="code-comment">// In C, 0 is false, non-zero is true</span>
    printf("x && y is %d\n", x && y); <span class="code-comment">// 逻辑与</span>
    printf("x || y is %d\n", x || y); <span class="code-comment">// 逻辑或</span>
    printf("!x is %d\n", !x);     <span class="code-comment">// 逻辑非</span>

    <span class="code-comment">// 赋值运算符</span>
    printf("\n--- 赋值运算符 ---\n");
    result = a;
    printf("result = a -> result = %d\n", result);
    result += b; <span class="code-comment">// result = result + b</span>
    printf("result += b -> result = %d\n", result);

    <span class="code-comment">// 自增/自减</span>
    printf("\n--- 自增/自减运算符 ---\n");
    int c = 5;
    printf("c = %d\n", c);
    printf("c++ (后缀) = %d, c after = %d\n", c++, c); <span class="code-comment">// c 先用于表达式，然后自增</span>
    c = 5; <span class="code-comment">// reset c</span>
    printf("++c (前缀) = %d, c after = %d\n", ++c, c); <span class="code-comment">// c 先自增，然后用于表达式</span>
    
    <span class="code-comment">// 条件运算符</span>
    printf("\n--- 条件运算符 ---\n");
    int max_val = (a > b) ? a : b;
    printf("Max of a and b is %d\n", max_val);
    
    <span class="code-comment">// sizeof 运算符</span>
    printf("\n--- sizeof 运算符 ---\n");
    printf("Size of int: %zu bytes\n", sizeof(int));
    printf("Size of variable a: %zu bytes\n", sizeof(a));

    return 0;
}</code></pre>
        </section>

        <section id="c-panduan" class="content-section">
            <h2>C 判断 (条件语句)</h2>
            <p>判断语句允许程序根据条件执行不同的代码路径。C 语言提供了以下几种判断语句：</p>
            <ul class="list-disc list-inside mb-4 pl-4 text-gray-600">
                <li><strong>`if` 语句:</strong> 如果条件为真，则执行 `if` 块内的代码。</li>
                <li><strong>`if...else` 语句:</strong> 如果条件为真，执行 `if` 块；否则，执行 `else` 块。</li>
                <li><strong>`if...else if...else` 语句 (嵌套 `if`):</strong> 用于测试多个条件。</li>
                <li><strong>`switch` 语句:</strong> 基于一个表达式的值，从多个 `case` 中选择一个执行。通常与 `break` 和 `default` 结合使用。</li>
            </ul>
            <h3>`if` 语句</h3>
            <pre><code class="language-c">#include &lt;stdio.h&gt;
int main() {
    int number = 10;
    if (number > 0) {
        printf("Number is positive.\n");
    }
    return 0;
}</code></pre>

            <h3>`if...else` 语句</h3>
            <pre><code class="language-c">#include &lt;stdio.h&gt;
int main() {
    int age = 15;
    if (age >= 18) {
        printf("Eligible to vote.\n");
    } else {
        printf("Not eligible to vote.\n");
    }
    return 0;
}</code></pre>

            <h3>`if...else if...else` 语句</h3>
            <pre><code class="language-c">#include &lt;stdio.h&gt;
int main() {
    int score = 85;
    if (score >= 90) {
        printf("Grade: A\n");
    } else if (score >= 80) {
        printf("Grade: B\n");
    } else if (score >= 70) {
        printf("Grade: C\n");
    } else {
        printf("Grade: D or F\n");
    }
    return 0;
}</code></pre>

            <h3>`switch` 语句</h3>
            <pre><code class="language-c">#include &lt;stdio.h&gt;
int main() {
    char grade = 'B';
    switch (grade) {
        case 'A':
            printf("Excellent!\n");
            break; <span class="code-comment">// break 语句用于跳出 switch 块</span>
        case 'B':
            printf("Well done\n");
            break;
        case 'C':
            printf("You passed\n");
            break;
        case 'D':
            printf("Better try again\n");
            break;
        default: <span class="code-comment">// 如果没有 case 匹配，则执行 default 块</span>
            printf("Invalid grade\n");
    }
    printf("Your grade is %c\n", grade);
    return 0;
}</code></pre>
            <p><strong>注意:</strong> 在 `switch` 语句中，如果 `case` 块末尾没有 `break`，程序会继续执行下一个 `case` 块的代码 (称为 "fall-through")，直到遇到 `break` 或 `switch` 语句结束。</p>
        </section>

        <section id="c-xunhuan" class="content-section">
            <h2>C 循环</h2>
            <p>循环语句允许程序重复执行一段代码，直到满足特定条件为止。C 语言提供了以下几种循环结构：</p>
            <ul class="list-disc list-inside mb-4 pl-4 text-gray-600">
                <li><strong>`while` 循环:</strong> 当给定条件为真时，重复执行代码块。条件在每次迭代开始前检查。</li>
                <li><strong>`do...while` 循环:</strong> 与 `while` 循环类似，但条件在每次迭代结束后检查。这意味着 `do...while` 循环至少会执行一次。</li>
                <li><strong>`for` 循环:</strong> 一种更紧凑的循环结构，通常用于已知迭代次数的情况。它包含初始化、条件和增量/减量三个部分。</li>
                <li><strong>嵌套循环:</strong> 在一个循环内部包含另一个循环。</li>
            </ul>
            <h3>`while` 循环</h3>
            <pre><code class="language-c">#include &lt;stdio.h&gt;
int main() {
    int i = 1;
    while (i <= 5) {
        printf("while loop, i = %d\n", i);
        i++; <span class="code-comment">// 必须有更新循环变量的语句，否则可能导致无限循环</span>
    }
    return 0;
}</code></pre>

            <h3>`do...while` 循环</h3>
            <pre><code class="language-c">#include &lt;stdio.h&gt;
int main() {
    int i = 1;
    do {
        printf("do...while loop, i = %d\n", i);
        i++;
    } while (i <= 5);

    int j = 10; <span class="code-comment">// 即使条件一开始为假，do...while 也会执行一次</span>
    do {
        printf("This will run at least once, j = %d\n", j);
        j++;
    } while (j < 5);
    return 0;
}</code></pre>

            <h3>`for` 循环</h3>
            <pre><code class="language-c">#include &lt;stdio.h&gt;
int main() {
    <span class="code-comment">// for (初始化; 条件; 增量/减量)</span>
    for (int i = 1; i <= 5; i++) {
        printf("for loop, i = %d\n", i);
    }
    return 0;
}</code></pre>

            <h3>循环控制语句</h3>
            <ul class="list-disc list-inside mb-4 pl-4 text-gray-600">
                <li><strong>`break` 语句:</strong> 立即终止最内层的循环或 `switch` 语句。</li>
                <li><strong>`continue` 语句:</strong> 跳过当前迭代中剩余的代码，并开始下一次迭代。</li>
            </ul>
            <h4>`break` 示例</h4>
            <pre><code class="language-c">#include &lt;stdio.h&gt;
int main() {
    for (int i = 1; i <= 10; i++) {
        if (i == 5) {
            printf("Breaking loop at i = %d\n", i);
            break; <span class="code-comment">// 当 i 等于 5 时跳出循环</span>
        }
        printf("i = %d\n", i);
    }
    return 0;
}</code></pre>
            <h4>`continue` 示例</h4>
            <pre><code class="language-c">#include &lt;stdio.h&gt;
int main() {
    for (int i = 1; i <= 5; i++) {
        if (i == 3) {
            printf("Skipping i = 3 with continue\n");
            continue; <span class="code-comment">// 当 i 等于 3 时跳过本次迭代的 printf</span>
        }
        printf("i = %d\n", i);
    }
    return 0;
}</code></pre>
        </section>
        </main>

    <div id="ai-chat-button" title="AI 编程助手">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-circle">
            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
        </svg>
    </div>

    <div id="ai-chat-modal">
        <div class="chat-header">
            <h3>Gemini 编程助手</h3>
            <button id="chat-close-btn" class="chat-close-button" title="关闭">&times;</button>
        </div>
        <div id="chat-messages" class="chat-messages">
            <div class="chat-message ai-message">你好！我是 Gemini，你的 C 语言编程助手。有什么可以帮你的吗？</div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chat-input" placeholder="输入你的问题..." autocomplete="off">
            <button id="chat-send-btn">发送</button>
        </div>
    </div>

    <script>
        const topics = [
            { id: 'c-jianjie', title: 'C 简介' },
            { id: 'c-huanjingshezhi', title: 'C 环境设置' },
            { id: 'c-vscode', title: 'C VSCode' },
            { id: 'c-ai-bianchengzhushou', title: 'C AI 编程助手' },
            { id: 'c-chengxujiegou', title: 'C 程序结构' },
            { id: 'c-jichuyufa', title: 'C 基础语法' },
            { id: 'c-shujuleixing', title: 'C 数据类型' },
            { id: 'c-bianliang', title: 'C 变量' },
            { id: 'c-changliang', title: 'C 常量' },
            { id: 'c-cunchulei', title: 'C 存储类' },
            { id: 'c-yunsuanfu', title: 'C 运算符' },
            { id: 'c-panduan', title: 'C 判断' },
            { id: 'c-xunhuan', title: 'C 循环' }
        ];

        const tocElement = document.getElementById('TableOfContents').querySelector('ul');
        const contentArea = document.getElementById('content-area');
        let navLinks = [];

        function showContent(targetId) {
            contentArea.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            const targetSection = document.getElementById(targetId);
            if (targetSection) {
                targetSection.classList.add('active');
            } else { // Fallback if targetId is not found (e.g. invalid hash)
                document.getElementById('welcome').classList.add('active');
            }
            navLinks.forEach(link => {
                link.classList.toggle('active', link.getAttribute('href') === `#${targetId}`);
            });
            contentArea.scrollTop = 0;
        }

        topics.forEach((topic) => {
            const listItem = document.createElement('li');
            const link = document.createElement('a');
            link.href = `#${topic.id}`;
            link.textContent = topic.title;
            link.classList.add('nav-link');
            link.addEventListener('click', (event) => {
                event.preventDefault();
                const targetId = event.target.getAttribute('href').substring(1);
                showContent(targetId);
                window.location.hash = targetId; 
            });
            listItem.appendChild(link);
            tocElement.appendChild(listItem);
            navLinks.push(link);
        });
        
        // --- MODIFIED INITIAL DISPLAY LOGIC ---
        let initialTopicId = 'welcome'; // Default to welcome page
        if (window.location.hash) {
            const hashId = window.location.hash.substring(1);
            // Check if the hashId is a valid topic or the welcome page itself
            if (topics.find(t => t.id === hashId) || hashId === 'welcome') {
                initialTopicId = hashId;
            }
            // If hash is invalid and not 'welcome', initialTopicId remains 'welcome'.
        }
        showContent(initialTopicId);
        // --- END OF MODIFIED LOGIC ---


        const aiChatButton = document.getElementById('ai-chat-button');
        const aiChatModal = document.getElementById('ai-chat-modal');
        const chatCloseBtn = document.getElementById('chat-close-btn');
        const chatMessagesContainer = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const chatSendBtn = document.getElementById('chat-send-btn');

        let chatHistory = [{ role: "model", parts: [{ text: "你好！我是 Gemini，你的 C 语言编程助手。有什么可以帮你的吗？" }] }]; 

        aiChatButton.addEventListener('click', () => {
            aiChatModal.classList.toggle('active');
            if (aiChatModal.classList.contains('active')) {
                chatInput.focus();
            }
        });

        chatCloseBtn.addEventListener('click', () => {
            aiChatModal.classList.remove('active');
        });

        chatSendBtn.addEventListener('click', sendMessageToAI);
        chatInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter' && !event.shiftKey) { 
                event.preventDefault(); 
                sendMessageToAI();
            }
        });

        function appendMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('chat-message', sender === 'user' ? 'user-message' : 'ai-message');

            let html = text;

            // Store preformatted blocks and replace them with placeholders
            const preBlocks = [];
            html = html.replace(/```([\s\S]*?)```/g, (match, codeContent) => {
                const codeTag = document.createElement('code');
                codeTag.textContent = codeContent.trim();
                const preTag = document.createElement('pre');
                preTag.appendChild(codeTag);
                preBlocks.push(preTag.outerHTML);
                return `___PRE_BLOCK_${preBlocks.length - 1}___`;
            });
            
            // Inline code `code`
            html = html.replace(/`([^`]+?)`/g, (match, codeContent) => {
                const codeTag = document.createElement('code');
                codeTag.textContent = codeContent;
                return codeTag.outerHTML;
            });

            // Bold: **text** or __text__
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/__(.*?)__/g, '<strong>$1</strong>');
            
            // Italics: *text* or _text_ (more specific to avoid conflict with bold)
            html = html.replace(/(?<![*\\])\*([^*]+)\*(?![*\\])/g, '<em>$1</em>'); // *italic*
            html = html.replace(/(?<![_\\])\_([^_]+)\_(?![_\\])/g, '<em>$1</em>'); // _italic_

            // Strikethrough: ~~text~~
            html = html.replace(/~~(.*?)~~/g, '<del>$1</del>');

            // Process lines for lists and newline conversion
            let lines = html.split(/\r\n|\r|\n/);
            let inList = false;
            let listHtml = "";

            lines.forEach(line => {
                if (line.startsWith('___PRE_BLOCK_')) { // Handle pre block placeholder lines
                    if (inList) {
                        listHtml += '</ul>';
                        inList = false;
                    }
                    listHtml += line + '\n'; // Preserve newline for pre block separation if any
                    return;
                }

                const listItemMatch = line.match(/^(\s*[\*\-\+]\s+)(.*)/);
                if (listItemMatch) {
                    let itemContent = listItemMatch[2];
                    if (!inList) {
                        listHtml += '<ul>';
                        inList = true;
                    }
                    listHtml += '<li>' + itemContent + '</li>';
                } else {
                    if (inList) {
                        listHtml += '</ul>';
                        inList = false;
                    }
                    listHtml += line + '\n'; // Add newline for non-list lines
                }
            });

            if (inList) { // Close any open list
                listHtml += '</ul>';
            }
            
            html = listHtml.trimEnd(); // Remove trailing newline if any

            // Convert remaining newlines (that are not part of pre block placeholders) to <br>
            // but only if they are not separating list elements or ul/li tags
            html = html.replace(/\n/g, '<br>');
            html = html.replace(/<\/ul><br><ul>/g, '</ul><ul>'); // Merge lists separated by a blank line
            html = html.replace(/<\/li><br><li>/g, '</li><li>'); // Connect list items

            // Reinsert <pre> blocks
            html = html.replace(/___PRE_BLOCK_(\d+)___/g, (match, index) => {
                return preBlocks[parseInt(index)];
            });
            // Final cleanup of <br> around <pre> or <ul>
            html = html.replace(/<br>(<pre|<ul)/g, '$1');
            html = html.replace(/(<\/pre|<\/ul>)<br>/g, '$1');


            messageDiv.innerHTML = html;
            chatMessagesContainer.appendChild(messageDiv);
            chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
        }
        
        async function sendMessageToAI() {
            const userMessageText = chatInput.value.trim();
            if (!userMessageText) return;

            appendMessage(userMessageText, 'user');
            chatHistory.push({ role: "user", parts: [{ text: userMessageText }] });
            chatInput.value = '';
            chatSendBtn.disabled = true;

            const loadingIndicator = document.createElement('div');
            loadingIndicator.classList.add('chat-message', 'ai-message', 'loading-indicator');
            loadingIndicator.textContent = 'Gemini 正在思考...';
            chatMessagesContainer.appendChild(loadingIndicator);
            chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;

            try {
                const apiKey = "AIzaSyALwVl1iwLavjaZW-Wx3FP2zJWoYzQfamU"; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const payload = { contents: chatHistory };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                chatMessagesContainer.removeChild(loadingIndicator);

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('API Error:', errorData);
                    const errorMsg = `抱歉，发生错误: ${errorData.error?.message || response.statusText}`;
                    appendMessage(errorMsg, 'ai');
                    chatHistory.push({ role: "model", parts: [{ text: errorMsg }] }); 
                    return;
                }

                const result = await response.json();
                
                let aiResponseText = "抱歉，我暂时无法回答。"; 
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    aiResponseText = result.candidates[0].content.parts[0].text;
                } else if (result.promptFeedback && result.promptFeedback.blockReason) {
                    aiResponseText = `无法生成回复，原因: ${result.promptFeedback.blockReason}`;
                     if (result.promptFeedback.blockReason === "SAFETY" && result.promptFeedback.safetyRatings) {
                        aiResponseText += ` (安全类别: ${result.promptFeedback.safetyRatings.map(r => r.category + '-' + r.probability).join(', ')})`;
                    }
                }
                
                appendMessage(aiResponseText, 'ai');
                chatHistory.push({ role: "model", parts: [{ text: aiResponseText }] });

            } catch (error) {
                console.error('Fetch Error:', error);
                if (chatMessagesContainer.contains(loadingIndicator)) {
                    chatMessagesContainer.removeChild(loadingIndicator);
                }
                const networkErrorMsg = '抱歉，连接AI助手时遇到网络问题。';
                appendMessage(networkErrorMsg, 'ai');
                chatHistory.push({ role: "model", parts: [{ text: networkErrorMsg }] });
            } finally {
                chatSendBtn.disabled = false;
                chatInput.focus();
            }
        }
    </script>
</body>
</html>
```
